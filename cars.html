<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <title>تفاصيل السيارة</title>
  <!-- Add to ALL HTML files -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* Keep your existing custom CSS */
    @import url('style.css');
  </style>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="car-card" id="car-details">جارٍ التحميل...</div>
  <script>
    const carsData = [
      { ser: 1, brand: "فورد", model: "فيوجن", color: "ابيض", year: 2019 },
      { ser: 2, brand: "هونداي", model: "I10", color: "فيراني", year: 2019 },
      { ser: 3, brand: "هونداي", model: "اكسنت", color: "كحلي", year: 2020 },
      { ser: 4, brand: "هونداي", model: "النترا", color: "اسود", year: 2020 },
      { ser: 5, brand: "هونداي", model: "النترا", color: "فيراني", year: 2020 },
      { ser: 6, brand: "هونداي", model: "النترا", color: "اسود", year: 2020 },
      { ser: 7, brand: "هونداي", model: "النترا", color: "احمر", year: 2020 },
      { ser: 8, brand: "هونداي", model: "النترا", color: "فيراني", year: 2020 },
      { ser: 9, brand: "هونداي", model: "اكسنت", color: "احمر", year: 2020 },
      { ser: 10, brand: "هونداي", model: "النترا", color: "احمر", year: 2020 },
      { ser: 11, brand: "هونداي", model: "النترا", color: "سلفر ميتالك", year: 2020 },
      { ser: 12, brand: "هونداي", model: "H1", color: "اسود", year: 2020 },
      { ser: 13, brand: "كيا", model: "سيراتو", color: "فيراني", year: 2022 },
      { ser: 14, brand: "كيا", model: "سيلتوس", color: "خمري", year: 2022 },
      { ser: 15, brand: "كيا", model: "سونيت", color: "اسود", year: 2022 },
      { ser: 16, brand: "كيا", model: "سيلتوس", color: "اسود", year: 2022 },
      { ser: 17, brand: "كيا", model: "بيجاس", color: "فيراني", year: 2022 },
      { ser: 18, brand: "كيا", model: "سيلتوس", color: "خمري", year: 2022 },
      { ser: 19, brand: "كيا", model: "سيلتوس", color: "خمري", year: 2022 },
      { ser: 20, brand: "كيا", model: "سونيت", color: "لؤلؤي", year: 2022 },
      { ser: 21, brand: "كيا", model: "سيراتو", color: "فيراني", year: 2022 },
      { ser: 22, brand: "كيا", model: "سونيت", color: "اسود", year: 2022 },
      { ser: 23, brand: "تويوتا", model: "كامري", color: "فيراني ميتالك", year: 2022 },
      { ser: 24, brand: "شفروليه", model: "كابتيفا", color: "اسود", year: 2023 },
      { ser: 25, brand: "تويوتا", model: "كامري", color: "فيراني ميتالك", year: 2023 },
      { ser: 26, brand: "تويوتا", model: "كامري", color: "فيراني ميتالك", year: 2023 },
      { ser: 27, brand: "تويوتا", model: "كامري", color: "سلفر ميتالك", year: 2023 },
      { ser: 28, brand: "تويوتا", model: "كامري", color: "سلفر ميتالك", year: 2023 },
      { ser: 29, brand: "تويوتا", model: "كامري", color: "سلفر ميتالك", year: 2023 },
      { ser: 30, brand: "شفروليه", model: "كابتيفا", color: "اسود", year: 2023 },
      { ser: 31, brand: "شفروليه", model: "كابتيفا", color: "فيراني", year: 2023 },
      { ser: 32, brand: "هونداي", model: "H1", color: "بني", year: 2019 },
      { ser: 33, brand: "هونداي", model: "H1", color: "فيراني", year: 2019 },
      { ser: 34, brand: "تويوتا", model: "كورولا", color: "سلفر ميتالك", year: 2023 },
      { ser: 35, brand: "تويوتا", model: "كورولا", color: "بحري ميتالك", year: 2023 },
      { ser: 36, brand: "تويوتا", model: "كورولا", color: "بحري ميتالك", year: 2023 },
      { ser: 37, brand: "تويوتا", model: "كورولا", color: "بحري ميتالك", year: 2023 },
      { ser: 38, brand: "تويوتا", model: "كورولا", color: "بحري ميتالك", year: 2023 },
      { ser: 39, brand: "تويوتا", model: "كورولا", color: "بحري ميتالك", year: 2023 },
      { ser: 40, brand: "كيا", model: "بيكانتو", color: "فضي", year: 2023 },
      { ser: 41, brand: "كيا", model: "بيكانتو", color: "اسود", year: 2023 },
      { ser: 42, brand: "كيا", model: "بيكانتو", color: "فضي", year: 2023 },
      { ser: 43, brand: "كيا", model: "بيكانتو", color: "اسود", year: 2023 },
      { ser: 44, brand: "هونداي", model: "النترا", color: "فيراني", year: 2020 },
      { ser: 45, brand: "هونداي", model: "النترا", color: "فيراني", year: 2025 },
      { ser: 46, brand: "هونداي", model: "H1", color: "اسود", year: 2019 },
      { ser: 47, brand: "هونداي", model: "sonata", color: "كحلي", year: 2022 },
      { ser: 48, brand: "هونداي", model: "sonata", color: "احمر", year: 2022 },
      { ser: 49, brand: "هونداي", model: "sonata", color: "فيراني", year: 2022 }
    ];
    const priceTable = {
      1: { "3-10": 30, "11-20": 28, "21-30": 25 },
      2: { "3-10": 22, "11-20": 20, "21-30": 18 },
      3: { "3-10": 22, "11-20": 20, "21-30": 18 },
      4: { "3-10": 25, "11-20": 22, "21-30": 20 },
      5: { "3-10": 25, "11-20": 22, "21-30": 20 },
      6: { "3-10": 26, "11-20": 24, "21-30": 22 },
      7: { "3-10": 27, "11-20": 25, "21-30": 23 },
      8: { "3-10": 28, "11-20": 26, "21-30": 24 },
      9: { "3-10": 29, "11-20": 27, "21-30": 25 },
      10: { "3-10": 30, "11-20": 28, "21-30": 26 },
      11: { "3-10": 24, "11-20": 22, "21-30": 20 },
      12: { "3-10": 23, "11-20": 21, "21-30": 19 },
      13: { "3-10": 22, "11-20": 20, "21-30": 18 },
      14: { "3-10": 21, "11-20": 19, "21-30": 17 },
      15: { "3-10": 23, "11-20": 21, "21-30": 19 },
      16: { "3-10": 24, "11-20": 22, "21-30": 20 },
      17: { "3-10": 25, "11-20": 23, "21-30": 21 },
      18: { "3-10": 26, "11-20": 24, "21-30": 22 },
      19: { "3-10": 27, "11-20": 25, "21-30": 23 },
      20: { "3-10": 28, "11-20": 26, "21-30": 24 },
      21: { "3-10": 30, "11-20": 28, "21-30": 26 },
      22: { "3-10": 32, "11-20": 30, "21-30": 28 },
      23: { "3-10": 34, "11-20": 32, "21-30": 30 },
      24: { "3-10": 36, "11-20": 34, "21-30": 32 },
      25: { "3-10": 38, "11-20": 36, "21-30": 34 },
      26: { "3-10": 40, "11-20": 38, "21-30": 36 },
      27: { "3-10": 42, "11-20": 40, "21-30": 38 },
      28: { "3-10": 44, "11-20": 42, "21-30": 40 },
      29: { "3-10": 46, "11-20": 44, "21-30": 42 },
      30: { "3-10": 48, "11-20": 46, "21-30": 44 },
      31: { "3-10": 50, "11-20": 48, "21-30": 46 },
      32: { "3-10": 33, "11-20": 31, "21-30": 29 },
      33: { "3-10": 31, "11-20": 29, "21-30": 27 },
      34: { "3-10": 29, "11-20": 27, "21-30": 25 },
      35: { "3-10": 28, "11-20": 26, "21-30": 24 },
      36: { "3-10": 26, "11-20": 24, "21-30": 22 },
      37: { "3-10": 24, "11-20": 22, "21-30": 20 },
      38: { "3-10": 22, "11-20": 20, "21-30": 18 },
      39: { "3-10": 20, "11-20": 18, "21-30": 16 },
      40: { "3-10": 21, "11-20": 19, "21-30": 17 },
      41: { "3-10": 23, "11-20": 21, "21-30": 19 },
      42: { "3-10": 25, "11-20": 23, "21-30": 21 },
      43: { "3-10": 27, "11-20": 25, "21-30": 23 },
      44: { "3-10": 29, "11-20": 27, "21-30": 25 },
      45: { "3-10": 31, "11-20": 29, "21-30": 27 },
      46: { "3-10": 33, "11-20": 31, "21-30": 29 },
      47: { "3-10": 35, "11-20": 33, "21-30": 31 },
      48: { "3-10": 37, "11-20": 35, "21-30": 33 },
      49: { "3-10": 39, "11-20": 37, "21-30": 35 },
    };



    function getPricePerDay(ser, days) {
      const pricing = priceTable[ser];
      if (!pricing) return 0;
      if (days >= 3 && days <= 10) return pricing["3-10"];
      if (days >= 11 && days <= 20) return pricing["11-20"];
      if (days >= 21 && days <= 30) return pricing["21-30"];
      return 0;
    }


    const params = new URLSearchParams(window.location.search);
    const ser = parseInt(params.get("ser"));
    const fromParam = params.get("from");
    const toParam = params.get("to");

    if (!fromParam || !toParam) {
      alert("التواريخ غير صالحة.");
      window.history.back();
    }

    const fromDate = new Date(fromParam);
    const toDate = new Date(toParam);

    if (isNaN(fromDate.getTime()) || isNaN(toDate.getTime())) {
      alert("التواريخ غير صالحة.");
      window.history.back();
    }

    const timeDiff = toDate.getTime() - fromDate.getTime();
    const rentalDays = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));


    if (rentalDays < 3) {
      alert("أقل مدة للحجز هي 3 أيام");
      window.history.back();
    }

    console.log("FROM:", fromParam, "TO:", toParam);
    console.log("Parsed FROM:", fromDate, "Parsed TO:", toDate);
    console.log("Rental Days:", rentalDays);




    const match = carsData.find(car => car.ser === ser);
    const perDay = getPricePerDay(ser, rentalDays);
    const totalPrice = perDay * rentalDays;
    const div = document.getElementById("car-details");

    if (!match) {
      div.innerHTML = "<p>لم يتم العثور على السيارة المطلوبة.</p>";
    } else {
      div.innerHTML = `
        <img src="Cars_Updated_Pictures/Ser_${match.ser}.jpg" alt="صورة السيارة" />
        <h3>${match.brand} - ${match.model}</h3>
        <p>اللون: ${match.color}</p>
        <p>الموديل: ${match.year}</p>
        ${match.ser === 1 ? `<p>رقم اللوحة: 47838</p>` : ''}

                <!-- ✅ ADD THIS HERE -->
                <p>عدد الأيام: ${rentalDays} يوم</p>
                <p>السعر اليومي: ${perDay} دينار</p>
                <p>الإجمالي: ${totalPrice} دينار</p>
                <a href="https://wa.me/+962780889953" target="_blank" class="btn btn-success d-flex align-items-center mb-2">
                  <i class="bi bi-whatsapp me-2" style="font-size: 1.2rem;"></i>
                  تواصل واتساب
                </a>
                <button onclick="addToCart()">أضف إلى السلة</button>

        <div class="pdf-container">
            <iframe src="Cars_Multiple_Pictures/Ser_Pic_${match.ser}.pdf" width="100%" height="500px"></iframe>
        </div>


      `;
    }


    function addToCart() {
      const car = {
        ser: match.ser,
        model: match.model,
        brand: match.brand,
        year: match.year,
        color: match.color,
        from: fromDate.toISOString().split('T')[0],
        to: toDate.toISOString().split('T')[0],
        days: rentalDays,
        daily: perDay,
        total: totalPrice
      };
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      cart.push(car);
      localStorage.setItem("cart", JSON.stringify(cart));
      alert("تمت إضافة السيارة إلى السلة!");
      window.history.back();
    }

  </script>
  <script>
    function makeReservation() {
      const formData = new FormData();

      const userId = 1; // Replace this with the actual logged-in user's ID if you have it
      const carId = ser; // From the URL (you already parsed `ser` above)
      const startDate = fromDate.toISOString().split('T')[0];
      const endDate = toDate.toISOString().split('T')[0];

      formData.append('user_id', userId);
      formData.append('car_id', carId);
      formData.append('start_date', startDate);
      formData.append('end_date', endDate);

      fetch('backend/addReservation.php', {
        method: 'POST',
        body: formData
      })
        .then(res => res.text())
        .then(data => {
          alert(data);
        })
        .catch(error => {
          console.error('Error:', error);
          alert('حدث خطأ أثناء الحجز!');
        });
    }
    function makeReservation() {
      const formData = new FormData();

      const userId = 1; // Replace this with the actual logged-in user's ID if you have it
      const carId = ser; // From the URL (you already parsed `ser` above)
      const startDate = fromDate.toISOString().split('T')[0];
      const endDate = toDate.toISOString().split('T')[0];

      formData.append('user_id', userId);
      formData.append('car_id', carId);
      formData.append('start_date', startDate);
      formData.append('end_date', endDate);

      fetch('backend/addReservation.php', {
        method: 'POST',
        body: formData
      })
        .then(res => res.text())
        .then(data => {
          alert(data);
        })
        .catch(error => {
          console.error('Error:', error);
          alert('حدث خطأ أثناء الحجز!');
        });
    }
    function makeReservation() {
      const formData = new FormData();

      const userId = 1; // Replace this with the actual logged-in user's ID if you have it
      const carId = ser; // From the URL (you already parsed `ser` above)
      const startDate = fromDate.toISOString().split('T')[0];
      const endDate = toDate.toISOString().split('T')[0];

      formData.append('user_id', userId);
      formData.append('car_id', carId);
      formData.append('start_date', startDate);
      formData.append('end_date', endDate);

      fetch('backend/addReservation.php', {
        method: 'POST',
        body: formData
      })
        .then(res => res.text())
        .then(data => {
          alert(data);
        })
        .catch(error => {
          console.error('Error:', error);
          alert('حدث خطأ أثناء الحجز!');
        });
    }

  </script>
  <!-- Add to ALL HTML files -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>